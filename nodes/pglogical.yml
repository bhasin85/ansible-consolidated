# eg.
# psql -h postgres.localnet -U admin -d postgres

- hosts:
    - pglogical.localnet
  vars_files:
    - ../vars/credentials.yml
  vars:
    - users:
      - { name: meteo, group: adm, pubkey: "{{meteo_pubkey}}" }
  roles:
    - jessie
    - timezone
    - locale
    - common
    - dotfiles
    - vim

  tasks:
    - copy:
        dest: /etc/apt/sources.list.d/2ndquadrant.list
        content: |
          # deployed by ansible!
          deb http://packages.2ndquadrant.com/pglogical/apt/ jessie-2ndquadrant main

    - copy:
        dest: /etc/apt/sources.list.d/pgdg.list
        content: |
          # deployed by ansible!
          deb http://apt.postgresql.org/pub/repos/apt/ jessie-pgdg main
 
    - shell: creates=postgres-done.txt chdir=/root {{item}}
      with_items:
        - apt-get install wget ca-certificates
        - wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
        - wget --quiet -O - http://packages.2ndquadrant.com/pglogical/apt/AA7A6805.asc | sudo apt-key add -
        - touch /ansible/pglogical-done.txt      


